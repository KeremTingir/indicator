<!DOCTYPE html>
<html class="dark" lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Asit-Baz Deneyi Ana Ekran</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
      rel="stylesheet"
    />
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#3b82f6",
              "lab-bg": "#0f172a",
            },
            fontFamily: {
              sans: ["Space Grotesk", "sans-serif"],
            },
          },
        },
      };
    </script>
    <style type="text/tailwindcss">
      :root {
        /* Başlangıçta çözeltinin nötr (yeşil) görünmesi için varsayılanlar */
        --flask-glow: rgba(52, 211, 153, 0.55);
        --liquid-top-start: #6ee7b7;
        --liquid-top-end: #10b981;
        --liquid-base-start: #22c55e;
        --liquid-base-end: #15803d;
      }
      .glass-panel {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .flask-glow {
        filter: drop-shadow(0 0 40px var(--flask-glow));
        transition: filter 0.4s ease, transform 0.4s ease;
      }
      .hide-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .hide-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      body {
        scroll-behavior: smooth;
      }
      .material-scroll {
        scroll-behavior: smooth;
        scroll-snap-type: x mandatory;
      }
      .flask-animate {
        animation: float 7s ease-in-out infinite;
      }
      @keyframes float {
        0% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
        100% {
          transform: translateY(0px);
        }
      }
      .drop-highlight {
        box-shadow: 0 0 40px rgba(96, 165, 250, 0.5);
        transform: scale(1.02);
      }
      /* Fokurdama animasyonu */
      .bubble-group circle {
        opacity: 0;
        transform-origin: center;
        transform-box: fill-box;
      }
      .bubble-group.bubble-active circle {
        animation: bubble-rise 1s ease-out forwards;
      }
      .bubble-group.bubble-active circle:nth-child(2) {
        animation-delay: 0.1s;
      }
      .bubble-group.bubble-active circle:nth-child(3) {
        animation-delay: 0.2s;
      }
      @keyframes bubble-rise {
        0% {
          transform: translateY(0px) scale(0.3);
          opacity: 0;
        }
        40% {
          opacity: 1;
        }
        100% {
          transform: translateY(-18px) scale(1);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body
    class="bg-lab-bg text-white min-h-screen flex flex-col overflow-hidden selection:bg-primary/30"
  >
    <main class="flex-1 flex flex-col relative overflow-hidden">
      <div class="absolute inset-0 z-0 overflow-hidden pointer-events-none">
        <div
          class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-blue-600/10 rounded-full blur-[120px]"
        ></div>
        <div
          class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-purple-600/10 rounded-full blur-[120px]"
        ></div>
        <div
          class="absolute inset-0 opacity-10"
          style="
            background-image: radial-gradient(
              circle at 2px 2px,
              rgba(255, 255, 255, 0.05) 1px,
              transparent 0
            );
            background-size: 40px 40px;
          "
        ></div>
      </div>

      <div class="z-10 pt-12 text-center">
        <h1 class="text-4xl font-bold tracking-tight text-white mb-2">
          Asit-Baz Deneyi
        </h1>
        <p
          class="text-slate-400 font-medium tracking-wide uppercase text-sm mb-4"
        >
          İnteraktif Kimya Laboratuvarı
        </p>
        <!-- İndikatör seçim barı -->
        <button
          id="indicator-toggle"
          type="button"
          class="inline-flex items-center gap-3 px-5 py-2 rounded-full bg-white/5 border border-white/10 shadow-lg hover:bg-white/10 transition-colors text-left cursor-pointer"
          onclick="cycleIndicator()"
        >
          <span
            class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-slate-900/60 border border-white/20"
          >
            <span
              id="indicator-chip-top"
              class="w-4 h-4 rounded-full bg-slate-300 block"
            ></span>
          </span>
          <span class="flex flex-col items-start leading-tight">
            <span
              class="text-[10px] font-semibold tracking-[0.2em] uppercase text-slate-400"
            >
              İndikatör
            </span>
            <span
              id="indicator-label-top"
              class="text-xs font-semibold text-slate-100"
            >
              Turnusol Kağıdı
            </span>
          </span>
          <span class="material-symbols-outlined text-slate-400 text-base ml-1">
            sync
          </span>
        </button>
      </div>

      <div
        class="flex-1 flex items-center justify-center relative z-10 px-4"
      >
        <!-- Sol: pH ve Durum kartları -->
        <div
          class="absolute left-4 md:left-12 top-1/2 -translate-y-1/2 flex flex-col gap-6 md:gap-8"
        >
          <div class="glass-panel p-6 rounded-2xl w-44 md:w-52 text-center">
            <p
              class="text-[10px] text-slate-400 uppercase tracking-widest mb-1"
            >
              pH Değeri
            </p>
            <p
              id="current-ph"
              class="text-4xl font-bold text-white"
            >
              7.0
            </p>
          </div>
          <div
            class="glass-panel p-6 rounded-2xl w-44 md:w-52 text-center border-l-4 border-l-emerald-500"
          >
            <p
              class="text-[10px] text-slate-400 uppercase tracking-widest mb-1"
            >
              Durum
            </p>
            <p
              id="current-state"
              class="text-xl font-bold text-emerald-400"
            >
              NÖTR
            </p>
          </div>
        </div>

        <!-- Orta: Kap ve yönlendirme -->
        <div class="relative flex flex-col items-center">
          <div
            id="drop-zone"
            class="flask-glow flask-animate relative group rounded-[40px]"
          >
            <!-- Statik SVG flask -->
            <svg
              fill="none"
              height="480"
              viewBox="0 0 320 420"
              width="360"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M120 40C120 30 128.954 20 140 20H180C191.046 20 200 28.9542 200 40V120L290 350C305 390 275 410 240 410H80C45 410 15 390 30 350L120 120V40Z"
                fill="rgba(255,255,255,0.03)"
                stroke="rgba(255,255,255,0.2)"
                stroke-width="2.5"
              ></path>
              <line
                stroke="rgba(255,255,255,0.2)"
                stroke-width="2"
                x1="130"
                x2="150"
                y1="80"
                y2="80"
              ></line>
              <line
                stroke="rgba(255,255,255,0.2)"
                stroke-width="2"
                x1="130"
                x2="160"
                y1="100"
                y2="100"
              ></line>
              <line
                stroke="rgba(255,255,255,0.1)"
                stroke-width="2"
                x1="90"
                x2="120"
                y1="300"
                y2="300"
              ></line>
              <line
                stroke="rgba(255,255,255,0.1)"
                stroke-width="2"
                x1="75"
                x2="110"
                y1="330"
                y2="330"
              ></line>
              <path
                d="M70 280L120 140V145H200V140L250 280C250 280 220 270 160 270C100 270 70 280 70 280Z"
                fill="url(#liquidTop)"
                opacity="0.6"
              ></path>
              <path
                d="M30 350L70 280C70 280 100 270 160 270C220 270 250 280 250 280L290 350C305 390 275 410 240 410H80C45 410 15 390 30 350Z"
                fill="url(#liquidBase)"
              ></path>
              <!-- Fokurdayan baloncuklar -->
              <g id="bubble-group" class="bubble-group">
                <circle cx="150" cy="255" r="4" fill="white" fill-opacity="0.5"></circle>
                <circle cx="170" cy="245" r="3" fill="white" fill-opacity="0.45"></circle>
                <circle cx="135" cy="240" r="2.5" fill="white" fill-opacity="0.4"></circle>
              </g>
              <path
                d="M140 50V90"
                stroke="white"
                stroke-linecap="round"
                stroke-opacity="0.1"
                stroke-width="3"
              ></path>
              <defs>
                <linearGradient
                  gradientUnits="userSpaceOnUse"
                  id="liquidTop"
                  x1="160"
                  x2="160"
                  y1="140"
                  y2="280"
                >
                  <stop
                    offset="0%"
                    stop-color="var(--liquid-top-start)"
                    stop-opacity="0.3"
                  ></stop>
                  <stop
                    offset="100%"
                    stop-color="var(--liquid-top-end)"
                    stop-opacity="0.8"
                  ></stop>
                </linearGradient>
                <linearGradient
                  gradientUnits="userSpaceOnUse"
                  id="liquidBase"
                  x1="160"
                  x2="160"
                  y1="270"
                  y2="410"
                >
                  <stop offset="0%" stop-color="var(--liquid-base-start)"></stop>
                  <stop offset="100%" stop-color="var(--liquid-base-end)"></stop>
                </linearGradient>
              </defs>
            </svg>
          </div>
          <div
            class="mt-8 glass-panel px-6 md:px-8 py-4 rounded-full flex items-center gap-3"
          >
            <span
              class="material-symbols-outlined text-primary animate-bounce"
            >
              drag_pan
            </span>
            <span class="text-sm font-semibold tracking-wide">
              Malzemeyi kaba sürükleyin veya kartlara tıklayın
            </span>
          </div>
        </div>

        <!-- Sağ: kontrol butonları -->
        <div
          class="absolute right-4 md:right-12 top-1/2 -translate-y-1/2 flex flex-col gap-4"
        >
          <button
            onclick="window.location.reload()"
            class="w-12 h-12 md:w-14 md:h-14 rounded-full glass-panel flex items-center justify-center text-white hover:bg-white/10 transition-all group"
          >
            <span
              class="material-symbols-outlined group-hover:rotate-180 transition-transform duration-500"
            >
              refresh
            </span>
          </button>
          <button
            onclick="goToResultPage()"
            class="w-12 h-12 md:w-14 md:h-14 rounded-full glass-panel flex items-center justify-center text-white hover:bg-white/10 transition-all"
          >
            <span class="material-symbols-outlined">analytics</span>
          </button>
        </div>
      </div>

      <!-- Alt: Malzeme kütüphanesi -->
      <div class="w-full pb-12 pt-4 px-4 md:px-12 z-20">
        <div class="max-w-7xl mx-auto">
          <div class="flex items-center justify-between mb-4 px-2">
            <span
              class="text-xs font-bold text-slate-400 uppercase tracking-[0.2em]"
            >
              Malzeme Kütüphanesi
            </span>
            <div class="flex gap-2">
              <div class="w-2 h-2 rounded-full bg-primary/40"></div>
              <div class="w-2 h-2 rounded-full bg-white/10"></div>
              <div class="w-2 h-2 rounded-full bg-white/10"></div>
            </div>
          </div>

          <div
            id="material-strip"
            class="flex gap-4 overflow-x-auto hide-scrollbar pb-4 -mx-2 px-2 snap-x material-scroll"
          >
            <!-- Limon -->
            <button
              class="min-w-[180px] snap-start glass-panel p-5 rounded-2xl hover:bg-white/5 transition-all duration-300 ease-out cursor-grab active:cursor-grabbing text-left group"
              draggable="true"
              data-substance="limon"
              onclick="selectSubstance('limon')"
            >
              <div
                class="w-14 h-14 rounded-xl bg-yellow-500/10 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"
              >
                <span
                  class="material-symbols-outlined text-yellow-500 text-3xl"
                >
                  nutrition
                </span>
              </div>
              <h4 class="font-bold text-white text-lg">Limon</h4>
              <p class="text-xs text-slate-400 mt-1">Sitrik Asit</p>
              <div class="mt-4 flex items-center gap-2">
                <span
                  class="text-[10px] px-2 py-0.5 rounded bg-red-500/10 text-red-400 font-bold"
                >
                  ASİT
                </span>
              </div>
            </button>

            <!-- Sirke -->
            <button
              class="min-w-[180px] snap-start glass-panel p-5 rounded-2xl hover:bg-white/5 transition-all duration-300 ease-out cursor-grab active:cursor-grabbing text-left group"
              draggable="true"
              data-substance="sirke"
              onclick="selectSubstance('sirke')"
            >
              <div
                class="w-14 h-14 rounded-xl bg-orange-500/10 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"
              >
                <span
                  class="material-symbols-outlined text-orange-500 text-3xl"
                >
                  water_drop
                </span>
              </div>
              <h4 class="font-bold text-white text-lg">Sirke</h4>
              <p class="text-xs text-slate-400 mt-1">Asetik Asit</p>
              <div class="mt-4 flex items-center gap-2">
                <span
                  class="text-[10px] px-2 py-0.5 rounded bg-red-500/10 text-red-400 font-bold"
                >
                  ASİT
                </span>
              </div>
            </button>

            <!-- Sabun -->
            <button
              class="min-w-[180px] snap-start glass-panel p-5 rounded-2xl hover:bg-white/5 transition-all duration-300 ease-out cursor-grab active:cursor-grabbing text-left group"
              draggable="true"
              data-substance="sabun"
              onclick="selectSubstance('sabun')"
            >
              <div
                class="w-14 h-14 rounded-xl bg-blue-500/10 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"
              >
                <span
                  class="material-symbols-outlined text-blue-500 text-3xl"
                >
                  soap
                </span>
              </div>
              <h4 class="font-bold text-white text-lg">Sabun</h4>
              <p class="text-xs text-slate-400 mt-1">Alkali Çözelti</p>
              <div class="mt-4 flex items-center gap-2">
                <span
                  class="text-[10px] px-2 py-0.5 rounded bg-blue-500/10 text-blue-400 font-bold"
                >
                  BAZ
                </span>
              </div>
            </button>

            <!-- Çamaşır Suyu -->
            <button
              class="min-w-[180px] snap-start glass-panel p-5 rounded-2xl hover:bg-white/5 transition-all duration-300 ease-out cursor-grab active:cursor-grabbing text-left group"
              draggable="true"
              data-substance="camasir"
              onclick="selectSubstance('camasir')"
            >
              <div
                class="w-14 h-14 rounded-xl bg-indigo-500/10 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"
              >
                <span
                  class="material-symbols-outlined text-indigo-400 text-3xl"
                >
                  cleaning_services
                </span>
              </div>
              <h4 class="font-bold text-white text-lg">Çamaşır Suyu</h4>
              <p class="text-xs text-slate-400 mt-1">Sodyum Hipoklorit</p>
              <div class="mt-4 flex items-center gap-2">
                <span
                  class="text-[10px] px-2 py-0.5 rounded bg-blue-500/10 text-blue-400 font-bold"
                >
                  BAZ
                </span>
              </div>
            </button>

            <!-- Saf Su -->
            <button
              class="min-w-[180px] snap-start glass-panel p-5 rounded-2xl hover:bg-white/5 transition-all duration-300 ease-out cursor-grab active:cursor-grabbing text-left group"
              draggable="true"
              data-substance="su"
              onclick="selectSubstance('su')"
            >
              <div
                class="w-14 h-14 rounded-xl bg-cyan-500/10 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"
              >
                <span
                  class="material-symbols-outlined text-cyan-400 text-3xl"
                >
                  opacity
                </span>
              </div>
              <h4 class="font-bold text-white text-lg">Saf Su</h4>
              <p class="text-xs text-slate-400 mt-1">H₂O</p>
              <div class="mt-4 flex items-center gap-2">
                <span
                  class="text-[10px] px-2 py-0.5 rounded bg-slate-500/10 text-slate-400 font-bold"
                >
                  NÖTR
                </span>
              </div>
            </button>

            <!-- Karbonat -->
            <button
              class="min-w-[180px] snap-start glass-panel p-5 rounded-2xl hover:bg-white/5 transition-all duration-300 ease-out cursor-grab active:cursor-grabbing text-left group"
              draggable="true"
              data-substance="karbonat"
              onclick="selectSubstance('karbonat')"
            >
              <div
                class="w-14 h-14 rounded-xl bg-emerald-500/10 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"
              >
                <span
                  class="material-symbols-outlined text-emerald-400 text-3xl"
                >
                  grain
                </span>
              </div>
              <h4 class="font-bold text-white text-lg">Karbonat</h4>
              <p class="text-xs text-slate-400 mt-1">Sodyum Bikarbonat</p>
              <div class="mt-4 flex items-center gap-2">
                <span
                  class="text-[10px] px-2 py-0.5 rounded bg-blue-500/10 text-blue-400 font-bold"
                >
                  BAZ
                </span>
              </div>
            </button>

            <!-- Mide Asidi -->
            <button
              class="min-w-[180px] snap-start glass-panel p-5 rounded-2xl hover:bg-white/5 transition-all duration-300 ease-out cursor-grab active:cursor-grabbing text-left group"
              draggable="true"
              data-substance="mide"
              onclick="selectSubstance('mide')"
            >
              <div
                class="w-14 h-14 rounded-xl bg-red-500/10 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"
              >
                <span
                  class="material-symbols-outlined text-red-400 text-3xl"
                >
                  biotech
                </span>
              </div>
              <h4 class="font-bold text-white text-lg">Mide Asidi</h4>
              <p class="text-xs text-slate-400 mt-1">Hidroklorik Asit</p>
              <div class="mt-4 flex items-center gap-2">
                <span
                  class="text-[10px] px-2 py-0.5 rounded bg-red-500/10 text-red-400 font-bold"
                >
                  ASİT
                </span>
              </div>
            </button>
          </div>
        </div>
      </div>
    </main>

    <script>
      const substanceInfo = {
        limon: { ph: 2.4, state: "Asit" },
        sirke: { ph: 3.0, state: "Asit" },
        sabun: { ph: 9.5, state: "Baz" },
        camasir: { ph: 12.5, state: "Baz" },
        su: { ph: 7.0, state: "Nötr" },
        karbonat: { ph: 8.5, state: "Baz" },
        mide: { ph: 1.5, state: "Asit" },
      };

      let selectedSubstance = "su";
      let selectedIndicator = "turnusol";

      function getIndicatorColor(indicator, state) {
        // Varsayılan gri ton
        const neutralGrey = "#e5e7eb";
        if (indicator === "turnusol") {
          if (state === "Asit") return "#f97373"; // kırmızı
          if (state === "Baz") return "#60a5fa"; // mavi
          return neutralGrey;
        }
        if (indicator === "fenolftalein") {
          if (state === "Baz") return "#ec4899"; // pembe
          // Asit ve nötr: renksiz / açık gri
          return "#d1d5db";
        }
        if (indicator === "mor-lahana") {
          if (state === "Asit") return "#f472b6"; // pembe
          if (state === "Baz") return "#22c55e"; // yeşil
          return "#a855f7"; // nötr: mor
        }
        return neutralGrey;
      }

      function updateIndicatorVisual(state) {
        const chipTop = document.getElementById("indicator-chip-top");
        const labelTop = document.getElementById("indicator-label-top");

        if (chipTop) {
          const color = getIndicatorColor(selectedIndicator, state);
          chipTop.style.backgroundColor = color;
        }

        if (labelTop) {
          if (selectedIndicator === "turnusol") {
              labelTop.textContent = "Turnusol Kağıdı";
          } else if (selectedIndicator === "fenolftalein") {
              labelTop.textContent = "Fenolftalein";
          } else if (selectedIndicator === "mor-lahana") {
              labelTop.textContent = "Mor Lahana Ekstraktı";
          }
        }
      }

      function selectIndicator(indicatorKey) {
        selectedIndicator = indicatorKey;
        const current = substanceInfo[selectedSubstance];
        const state = current ? current.state : "Nötr";
        updateIndicatorVisual(state);
      }

      function cycleIndicator() {
        const order = ["turnusol", "fenolftalein", "mor-lahana"];
        const currentIndex = order.indexOf(selectedIndicator);
        const nextIndex = (currentIndex + 1) % order.length;
        selectIndicator(order[nextIndex]);
      }

      function selectSubstance(key) {
        const info = substanceInfo[key];
        if (info) {
          // Küçük bir görsel geri bildirim için anlık olarak kartları güncelle
          const phEl = document.getElementById("current-ph");
          const stateEl = document.getElementById("current-state");
          if (phEl && stateEl) {
            phEl.textContent = info.ph.toString();
            stateEl.textContent = info.state.toUpperCase();

            // Duruma göre yazı rengini değiştir (asit: kırmızı, nötr: yeşil, baz: mavi)
            const baseClasses = "text-xl font-bold";
            if (info.state === "Asit") {
              stateEl.className = `${baseClasses} text-red-400`;
            } else if (info.state === "Baz") {
              stateEl.className = `${baseClasses} text-blue-400`;
            } else if (info.state === "Nötr") {
              stateEl.className = `${baseClasses} text-emerald-400`;
            } else {
              stateEl.className = `${baseClasses} text-purple-400`;
            }
          }

          // İndikatör rengini güncelle
          updateIndicatorVisual(info.state);

          // Flask rengini ve ışımasını asit / baz / nötr durumuna göre güncelle
          const root = document.documentElement;
          const isAcid = info.state === "Asit";
          const isBase = info.state === "Baz";
          const isNeutral = info.state === "Nötr";

          if (isAcid) {
            root.style.setProperty("--flask-glow", "rgba(248,113,113,0.55)");
            root.style.setProperty("--liquid-top-start", "#fb7185");
            root.style.setProperty("--liquid-top-end", "#b91c1c");
            root.style.setProperty("--liquid-base-start", "#ef4444");
            root.style.setProperty("--liquid-base-end", "#7f1d1d");
          } else if (isBase) {
            root.style.setProperty("--flask-glow", "rgba(59,130,246,0.55)");
            root.style.setProperty("--liquid-top-start", "#60a5fa");
            root.style.setProperty("--liquid-top-end", "#1d4ed8");
            root.style.setProperty("--liquid-base-start", "#3b82f6");
            root.style.setProperty("--liquid-base-end", "#1e3a8a");
          } else if (isNeutral) {
            root.style.setProperty("--flask-glow", "rgba(52,211,153,0.55)");
            root.style.setProperty("--liquid-top-start", "#6ee7b7");
            root.style.setProperty("--liquid-top-end", "#10b981");
            root.style.setProperty("--liquid-base-start", "#22c55e");
            root.style.setProperty("--liquid-base-end", "#15803d");
          }

          // Fokurdama animasyonu tetikle
          const bubbleGroup = document.getElementById("bubble-group");
          if (bubbleGroup) {
            const bubbles = bubbleGroup.querySelectorAll("circle");
            // Mevcut animasyonu sıfırla
            bubbles.forEach((circle) => {
              circle.style.animation = "none";
            });
            // reflow için
            void bubbleGroup.offsetWidth;
            // Her madde eklemede animasyonu yeniden başlat
            bubbles.forEach((circle, index) => {
              circle.style.animation = `bubble-rise 1s ease-out forwards`;
              circle.style.animationDelay = `${index * 0.1}s`;
            });
          }

          selectedSubstance = key;
        }
      }

      // Sayfa ilk açıldığında nötr (su) için renkleri ve yazıyı senkronize et
      window.addEventListener("DOMContentLoaded", () => {
        selectSubstance("su");
        updateIndicatorVisual("Nötr");
      });

      function goToResultPage() {
        const key = selectedSubstance || "su";
        // Yerel dosya sisteminde (file://) sorunsuz çalışması için göreli yönlendirme kullan
        window.location.href = `result.html?madde=${encodeURIComponent(key)}`;
      }

      // Drag & drop için olaylar
      const dropZone = document.getElementById("drop-zone");
      const materialStrip = document.getElementById("material-strip");

      if (materialStrip) {
        materialStrip.addEventListener("dragstart", (event) => {
          const target = event.target && event.target.closest("button[data-substance]");
          if (!event.dataTransfer || !target) return;
          const key = target.dataset.substance;
          if (key) {
            event.dataTransfer.setData("text/substance", key);
            event.dataTransfer.effectAllowed = "move";
          }
        });
      }

      if (dropZone) {
        ["dragenter", "dragover"].forEach((type) => {
          dropZone.addEventListener(type, (event) => {
            event.preventDefault();
            if (event.dataTransfer) {
              event.dataTransfer.dropEffect = "move";
            }
            dropZone.classList.add("drop-highlight");
          });
        });

        ["dragleave", "drop"].forEach((type) => {
          dropZone.addEventListener(type, () => {
            dropZone.classList.remove("drop-highlight");
          });
        });

        dropZone.addEventListener("drop", (event) => {
          event.preventDefault();
          if (!event.dataTransfer) return;
          const key = event.dataTransfer.getData("text/substance");
          if (key) {
            selectSubstance(key);
          }
        });
      }
    </script>
  </body>
</html>

